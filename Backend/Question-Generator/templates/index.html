<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Plugin for Moodle</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <!-- Top Bar -->
  <nav class="topbar" role="navigation" aria-label="Primary">
    <div class="brand">
      <i class='bx bx-bulb card-icon'></i>
      <span>AI Plugin</span>
    </div>
    <ul class="topnav">
      <li><button class="link" data-route="home">Home</button></li>
      <li><button class="link" data-route="generate">Generate Quiz</button></li>
      <li><button class="link" data-route="view">View Quizzes</button></li>
      <li><button class="link" data-route="grades">Student Grades</button></li>
    </ul>
  </nav>

  <main>

    <!-- HOME -->
    <section id="section-home">
      <div class="home-grid">
        <div class="home-left">
          <h1 class="headline">Welcome to <span>AI Plugin</span></h1>
          <p class="subhead">
            Experience the future of learning with our AI-powered<br/>
            Moodle plugin. Transform any study material into interactive<br/>
            quizzes and assignments ‚Äî automatically, intelligently.
          </p>
        </div>

        <div class="home-right">
          <div class="rotate-card has-bg" 
               style="--card-bg: url('{{ url_for('static', filename='card.jpg') }}')"
               aria-live="polite">
            <div id="rotate-text" class="rotate-text">
              <span>Smart PDF Conversion ‚Äî Automatically generate quizzes from textbooks and materials</span>
              <span>Instant Quiz Creation ‚Äî Quickly transform study content into assessment tools</span>
              <span>Personalized Assessment ‚Äî Customize question distribution and complexity levels</span>
              <span>Manual Authoring ‚Äî Craft bespoke questions with comprehensive creation tools</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- GENERATE -->
    <section id="section-generate" style="display:none;">
      <div class="cards-container">
        <div class="quiz-card" id="card-auto">
          <i class='bx bx-brain card-icon'></i>
          <h2>AI-Powered Quiz</h2>
          <p>Upload your study material in PDF format and let our AI automatically create a quiz for you.</p>
          <button class="generate-btn" id="btn-open-auto">Generate Quiz</button>
        </div>

        <!-- Customize Quiz Card -->
        <div class="quiz-card">
          <i class='bx bx-slider-alt card-icon'></i>
          <h2>Customize Quiz</h2>
          <p>Pick exact counts per type, plus scenario/code flags.</p>
          <button class="generate-btn" id="btn-open-custom">Customize Now</button>
        </div>

        <!-- Manual Creation Card -->
        <div class="quiz-card">
          <i class='bx bx-edit card-icon'></i>
          <h2>Manual Creation</h2>
          <p>Create questions from scratch with full control.</p>
          <button class="generate-btn" disabled title="Coming soon">Start Creating</button>
        </div>
      </div>

      <!-- Generated Quiz Output Section -->
      <section id="quiz-section" aria-live="polite" style="display:none">
        <div class="quiz-out-head">
          <h2>Generated Quiz</h2>
          <div class="quiz-actions">
            <button class="btn" id="btn-copy-quiz" type="button">Copy as Text</button>
            <button class="btn" id="btn-save-json" type="button">Save JSON</button>
            <button class="btn" id="btn-publish" type="button">Download</button>
            <span id="publish-note" class="muted" style="margin-left:8px;"></span>
          </div>
        </div>
        <div id="quiz-container" class="quiz-out"></div>
      </section>
    </section>

    <!-- VIEW QUIZZES -->
    <section id="section-view" style="display:none;">
      <div class="view-header">
        <h2>Available Quizzes</h2>
        <p class="muted">Open any quiz to preview or share with students.</p>
      </div>

      <!-- Empty state -->
      <div id="quiz-empty" class="empty-state" style="display:none;">
        <div class="empty-icon">üìÑ</div>
        <h3>No quizzes yet</h3>
        <p>Generate a quiz first, then come back to view it here.</p>
      </div>

      <!-- List container -->
      <div id="quiz-list" class="quiz-list"></div>
    </section>

    <!-- STUDENT GRADES (placeholder page) -->
    <section id="section-grades" style="display:none;">
      <div class="grades-header">
        <h2>Student Grades</h2>
      </div>
      <div class="empty-state">
        <div class="empty-icon">üìù</div>
        <h3>Grades page</h3>
        <p>Grades logic is not implemented yet. This is placeholder text as requested.</p>
      </div>
    </section>

  </main>

  <div id="toast" class="toast"></div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settings-modal-title" style="display:none;">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="settings-modal-title">Quiz Settings</h3>
        <button class="btn-close" id="btn-close-settings" aria-label="Close settings">
          <i class='bx bx-x'></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label for="time-limit" class="label">Time Limit (minutes)</label>
          <input type="number" id="time-limit" min="0" max="480" placeholder="0 for no limit">
          <div class="hint">Set to 0 for unlimited time</div>
        </div>

        <div class="form-group">
          <label for="due-date" class="label">Due Date</label>
          <input type="datetime-local" id="due-date">
          <div class="hint">Leave empty for no due date</div>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="allow-retakes">
            <span class="checkmark"></span>
            Allow multiple attempts
          </label>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="shuffle-questions">
            <span class="checkmark"></span>
            Shuffle questions
          </label>
        </div>

        <div class="form-group">
          <label for="notification-message" class="label">Notification Message</label>
          <textarea id="notification-message" placeholder="Optional message to send with quiz..." rows="3"></textarea>
        </div>
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="btn-cancel-settings">Cancel</button>
        <button class="btn primary" id="btn-save-settings">Save Settings</button>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div id="modal-auto" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitleAuto">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="modalTitleAuto">Generate Quiz from PDF</h3>
        <div class="modal-actions">
          <button class="btn ghost" id="btn-cancel">Close</button>
          <button class="btn primary" id="btn-generate">Generate</button>
        </div>
      </div>
      <div class="section-title">1) Upload PDF</div>
      <div id="uploader" class="uploader">
        <b>Drop PDF here</b> or click to select
        <small>Accepted: .pdf (max ~25MB)</small>
        <input id="fileInput" type="file" accept="application/pdf" hidden />
      </div>
      <div class="progress" id="progress"><div></div></div>
    </div>
  </div>

  <div id="modal-custom" class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitleCustom">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="modalTitleCustom">Customize Quiz from PDF</h3>
      <div class="modal-actions">
          <button class="btn ghost" id="btn-cancel-custom">Close</button>
          <button class="btn primary" id="btn-generate-custom">Generate</button>
        </div>
      </div>

      <div class="section-title">1) Upload PDF</div>
      <div id="uploader-custom" class="uploader">
        <b>Drop PDF here</b> or click to select
        <small>Accepted: .pdf (max ~25MB)</small>
        <input id="fileInputCustom" type="file" accept="application/pdf" hidden />
      </div>

      <div style="margin-top:12px;">
        <button id="btn-detect-subtopics" type="button" class="btn">Detect Subtopics</button>
      </div>

      <div id="subtopics-section" style="display:none; margin-top:10px;">
        <p><strong>Select subtopics:</strong></p>
        <div id="subtopics-list" class="subtopics-list"></div>
      </div>

      <div class="section-title">2) Question Counts</div>
      <div class="counts-grid">
        <div class="field">
          <label class="label" for="mcqCount">MCQ</label>
          <input id="mcqCount" type="number" min="0" max="30" value="4" />
        </div>
        <div class="field">
          <label class="label" for="tfCount">True / False</label>
          <input id="tfCount" type="number" min="0" max="30" value="0" />
        </div>
        <div class="field">
          <label class="label" for="shortCount">Short</label>
          <input id="shortCount" type="number" min="0" max="20" value="5" />
        </div>
        <div class="field">
          <label class="label" for="longCount">Long</label>
          <input id="longCount" type="number" min="0" max="20" value="0" />
        </div>
      </div>

      <div class="section-title">3) Difficulty level</div>
      <div class="form-row">
        <div class="field">
          <label class="label">Mode</label>
          <select id="difficultyModeCustom">
            <option value="auto">Auto (AI decides)</option>
            <option value="custom">Custom % mix</option>
          </select>
          <div class="hint">Use custom only if you want a specific E/M/H distribution.</div>
        </div>
        <div class="field">
          <label class="label">Validate</label>
          <button class="btn" id="btn-validate-mix" type="button">Sum = 100%</button>
        </div>
      </div>
      <div id="diffRowC1" class="form-row" style="display:none">
        <div class="field">
          <label class="label">Easy %</label>
          <input id="easyPctC" type="number" min="0" max="100" value="30" />
        </div>
        <div class="field">
          <label class="label">Medium %</label>
          <input id="medPctC" type="number" min="0" max="100" value="50" />
        </div>
      </div>
      <div id="diffRowC2" class="form-row" style="display:none">
        <div class="field">
          <label class="label">Hard %</label>
          <input id="hardPctC" type="number" min="0" max="100" value="20" />
        </div>
      </div>

      <div class="progress" id="progress-custom"><div></div></div>
    </div>
  </div>

  <!-- Scripts (deferred) -->
  <script src="{{ url_for('static', filename='script.js') }}" defer></script>
  <script src="{{ url_for('static', filename='modal.js') }}" defer></script>
  <script src="{{ url_for('static', filename='customizeModal.js') }}" defer></script>
  <script src="{{ url_for('static', filename='publish.js') }}" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" defer></script>
  <script src="{{ url_for('static', filename='setting.js') }}" defer></script>

</body>
</html>